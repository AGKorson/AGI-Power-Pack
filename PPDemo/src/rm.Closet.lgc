[ ********************************************************************[[ rm.Closet[[ [[ ********************************************************************#define wall        o1#define broom       o2#define fDone     f220#define fFalling  f221#define startfall f222#define clickmops   f223if (newRoom) {  [ this is the first cycle through this room  [ load, draw and discard the picture resource for the current room  load.pic(currentRoom);  draw.pic(currentRoom);  discard.pic(currentRoom);    [ do basic room initialization  call(lgc.RoomInit);    [ the horizon defines the upper limit of ego's movement  set.horizon(0);    [ add toolbar buttons  load.view(vw.Toolbar);  call(lgc.InitToolbar);    load.view(vw.ClosetArt);  animate.obj(wall);  set.view(wall, vw.ClosetArt);  set.loop(wall, 1);  position(wall, 69, 142);  set.priority(wall, 4);  [ if wall not broken yet, cover up the hole  if (!wallbreak) {    set.cel(wall, 0);  } else {    set.cel(wall, 12);    ignore.objs(wall);  }  draw(wall);  stop.update(wall);    [ add the broom, if not picked up yet  if (!broommoved) {    animate.obj(broom);    set.view(broom, vw.ClosetArt);    set.loop(broom, 0);    set.cel(broom, 0);    set.priority(broom, 11);    position(broom, 59, 152);    draw(broom);    stop.update(broom);    ignore.objs(broom);  }    [ add additional room initialization here  egoDir = STOPPED;  if (previousRoom == rm.Hallway) {    position(ego, 71, 156);    set.loop(ego, 3);  }  if (previousRoom == rm.SecretRoom) {    position(ego, 72, 141);    set.loop(ego, 1);  }  egoDir = STOPPED;    [ add ego to the room  draw(ego);    [ display the picture on screen  show.pic();  [ fade in  block(FADE.IN, 0, FADECOUNT, BLACK); [ fade.in(BYVAR, DELAY, COLOR)  [ restore cursor  cursoricon = cursormode;  set.key(1, &cursoricon, mouse); [ set.cursor(BYVAR, MSGNUM);  return();}[*****:handleInput       [ check for input from player[*****if (haveInput && !haveMatch && unknownWordNum == 0)  {  [ place said tests here  if (said("look"))    {    print("This is an old janitor closet.");    }  }[ toolbar button checks[ if NOT clicking on the actual toolbar, check for[ clicks on ingame itemsif (mouseY > 25 && controller(cLeftClick)) {  [ look  if (cursormode == C_LOOK) {    [ same as 'look'    print("This is an old janitor closet.");        goto(doneclick);  }    [ talk  if (cursormode == C_TALK) {    [ ego    if (posn(ego, ON.OBJ, 1, &mouseX, &mouseY)) {      print("You have nothing to say.");    } else {      print("There is no one here to talk to.");    }    set.key(-1, -1, cLeftClick); [ clear.controller(cLeftClick);    goto(doneclick);  }  [ grab/use  if (cursormode == C_USE) {    [ same as 'grab/use item'      [ ego    if (posn(ego, ON.OBJ, 1, &mouseX, &mouseY)) {      print("Please don't touch yourself. Not even in a closet.");      goto(doneclick);    }        [ broom '59-64 155-162    if (mouseX > 59 && mouseX < 64 && mouseY > 155 && mouseY < 162) {[    if (posn(broom, ON.OBJ, 1, &mouseX, &mouseY)) {      if ((obj.in.box(ego, 62, 140, 78, 143) || obj.in.box(ego, 59, 144, 75, 147) ||           obj.in.box(ego, 55, 147, 71, 149) || obj.in.box(ego, 55, 148, 71, 152))) {        print("As you bend over to pick up the broom, you trip and fall!");        set(startfall);      } else {        print("You can't reach that(broom) from here.");      }      goto(doneclick);    }        [ faucet (62, 117, 66, 123)    if (mouseX > 61 && mouseX < 67 && mouseY > 124 && mouseY < 132) {      if (posn(ego, 57, 140, 70, 146)) {       print("you turn on the water.");      } else {        print("You can't reach that(faucet) from here.");      }      goto(doneclick);    }        [ sink (59, 123, 68, 134)    if (mouseX > 58 && mouseX < 69 && mouseY > 130 && mouseY < 143) {      if (posn(ego, 57, 140, 70, 146)) {        print("might as well wash your hands");      } else {        print("You can't reach that(sink) from here.");      }      goto(doneclick);    }        [ mop/bucket/items on wall (41, 106, 48, 148 || 49, 117, 52, 142 || 53, 126, 58, 142)    reset(clickmops);    if (mouseX > 40 && mouseX < 49 && mouseY > 113 && mouseY < 157) {      set(clickmops);    }    if (mouseX > 48 && mouseX < 53 && mouseY > 124 && mouseY < 151) {      set(clickmops);    }    if (mouseX > 52 && mouseX < 59 && mouseY > 133 && mouseY < 151) {      set(clickmops);    }    if (clickmops) {      if ((posn(ego, 52, 138, 61, 149) || posn(ego, 41, 148, 51, 155))) {        print("As much as you've always wanted to become a janitor, perhaps you "              " should just leave the mops and brooms alone.");      } else {        print("You can't reach that(mops) from here.");      }      goto(doneclick);    }        [ plunger (80, 129, 84, 141)    if (mouseX > 79 && mouseX < 85 && mouseY > 136 && mouseY < 150) {      if (obj.in.box(ego, 72, 138, 92, 147)) {        print("You decide to leave the plunger alone. It smells bad.");      } else {        print("You can't reach that(plunger) from here.");      }      goto(doneclick);    }    [ boxes on top shelf (86, 92, 102, 102)    if (mouseX > 85 && mouseX < 103 && mouseY > 99 && mouseY < 111) {      if (obj.in.box(ego, 83, 140, 108, 146)) {        print("The boxes are up too high for you to reach.");      } else {        print("You can't reach that(topbox) from here.");      }      goto(doneclick);    }        [ boxes on ground (90, 139, 112, 154)    if (mouseX > 89 && mouseX < 113 && mouseY > 146 && mouseY < 163) {      if (obj.in.box(ego, 83, 144, 108, 156)) {        print("The boxes are sealed up. You can't open them.");      } else {        print("You can't reach that(boxfloor) from here.");      }      goto(doneclick);    }        [ shelf1 supplies (89, 107, 102, 113)    if (mouseX > 88 && mouseX < 103 && mouseY > 114 && mouseY < 122) {      if (obj.in.box(ego, 85, 140, 108, 146)) {        print("You have no need for cleaning supplies.");      } else {        print("You can't reach that(shelf1) from here.");      }      goto(doneclick);    }        [ shelf2 supplies (89, 118, 102, 126)    if (mouseX > 88 && mouseX < 103 && mouseY > 125 && mouseY < 135) {      if (obj.in.box(ego, 85, 140, 108, 146)) {        print("You have no need for cleaning supplies.");      } else {        print("You can't reach that(shelf2) from here.");      }      goto(doneclick);    }        [ shelf (84, 103, 105, 141)    if (mouseX > 83 && mouseX < 106 && mouseY > 110 && mouseY < 150) {      if (obj.in.box(ego, 85, 140, 108, 146)) {        print("There is nothing you can do with the shelf.");      } else {        print("You can't reach that(shelf) from here.");      }      goto(doneclick);    }        [ floor drain (75, 146, 79, 149)    if (mouseX > 74 && mouseX < 80 && mouseY > 154 && mouseY < 160) {      if (obj.in.box(ego, 66, 142, 88, 153)) {        print("The drain is firmly attached to the floor. You can't pull it up.");        goto(doneclick);      } else {        print("You can't reach that from here.");      }    }        [ steam pipe (44, 77, 98, 83)    if (mouseX > 43 && mouseX < 99 && mouseY > 84 && mouseY < 94) {[      if (obj.in.box(ego, 66, 142, 88, 153)) {        print("You can't reach the pipe. Not even if you jumped.");[       } else {[        print("You can't reach that from here.");[      }    }  }    :doneclick  set.key(-1, -1, cLeftClick); [ clear.controller(cLeftClick);}[*****:noInput           [  all non-input related code goes here [*****[ add other room specific statements hereif (egoHitSpecial && !wallbreak && egoY > 141) {  [ fall, and break wall  print("Look out for that broom!");  set(startfall);}if (startfall) {  reset(startfall);  start.update(wall);  end.of.loop(wall, fDone);  set(fFalling);  set(wallbreak);  egodir = STOPPED;  program.control();  prevent.input();}if (fDone) {  reset(fDone);  reset(fFalling);  stop.update(wall);  print("As you fall against the wall, it caves in, revealing a large hole.");  ignore.objs(wall);  player.control();  accept.input();}[*****:exit              [  test for leaving the room[*****[ add exit checks here (or use layout editor)if (wallbreak && !fFalling && posn(ego, 70, 139, 80, 139)) {  [ show wait cursor  cursoricon = C_WAIT;  set.key(1, &cursoricon, mouse); [ set.cursor(BYVAR, MSGNUM);  [ fade out, then change room  block(FADE.OUT, 0, FADECOUNT, BLACK); [ fade.out(BYVAR, DELAY, COLOR)  new.room(rm.SecretRoom);  [ ##LE002##}if (posn(ego, 68, 158, 82, 158)) {  [ show wait cursor  cursoricon = C_WAIT;  set.key(1, &cursoricon, mouse); [ set.cursor(BYVAR, MSGNUM);  [ fade out, then change room  block(FADE.OUT, 0, FADECOUNT, BLACK); [ fade.out(BYVAR, DELAY, COLOR)  new.room(rm.Hallway);  [ ##LE001##}return();[*****[ messages         [  declared messages go here[*****#message 1 "%g40"#message 2 "%g41"#message 3 "%g42"#message 4 "%g43"#message 5 "%g44"#message 6 "%g45"